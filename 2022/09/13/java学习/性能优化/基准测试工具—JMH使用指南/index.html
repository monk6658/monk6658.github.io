<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JMHä½¿ç”¨æŒ‡å— | å°æ˜çš„åšå®¢</title>
  <meta name="keywords" content=" åŸºå‡†æµ‹è¯•å·¥å…· , JMH ">
  <meta name="description" content="JMHä½¿ç”¨æŒ‡å— | å°æ˜çš„åšå®¢">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Java ä»£ç æ€§èƒ½æµ‹è¯•çš„å·¥å…·ï¼ŒJMHåªé€‚åˆç»†ç²’åº¦çš„æ–¹æ³•æµ‹è¯•ï¼Œå¹¶ä¸é€‚ç”¨äºç³»ç»Ÿä¹‹é—´çš„é“¾è·¯æµ‹è¯•.">
<meta property="og:type" content="article">
<meta property="og:title" content="JMHä½¿ç”¨æŒ‡å—">
<meta property="og:url" content="https://monk6658.github.io/2022/09/13/java%E5%AD%A6%E4%B9%A0/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E2%80%94JMH%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="å°æ˜çš„åšå®¢">
<meta property="og:description" content="Java ä»£ç æ€§èƒ½æµ‹è¯•çš„å·¥å…·ï¼ŒJMHåªé€‚åˆç»†ç²’åº¦çš„æ–¹æ³•æµ‹è¯•ï¼Œå¹¶ä¸é€‚ç”¨äºç³»ç»Ÿä¹‹é—´çš„é“¾è·¯æµ‹è¯•.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-09-12T16:00:00.000Z">
<meta property="article:modified_time" content="2022-09-14T09:30:46.624Z">
<meta property="article:author" content="å°æ˜åŒé‹">
<meta property="article:tag" content="åŸºå‡†æµ‹è¯•å·¥å…·">
<meta property="article:tag" content="JMH">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/head.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 5.4.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/head.jpg" />
</a>
<div class="author">
    <span>å°æ˜åŒé‹</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/monk6658" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=1245141646&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
        <a title="email" href="mailto:monk6658@163.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active" data-rel="All">All<small>(27)</small></div></li>
    
        
            
            <li><div data-rel="å·¥å…·">å·¥å…·<small>(7)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="å¹¶å‘">å¹¶å‘<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="å¹¶å‘ã€netty">å¹¶å‘ã€netty<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="ç®—æ³•">ç®—æ³•<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="å°ç¨‹åº">å°ç¨‹åº<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="ä¸­é—´ä»¶">ä¸­é—´ä»¶<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="docker">docker<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="JAVA">JAVA<small>(8)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="JVM">JVM<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Linux">Linux<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="mysql">mysql<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="oracle">oracle<small>(2)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a  class="friends">Friends</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="27">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">åŸhexoä¸»é¢˜åšä¸»</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æŒ‰ä½ä¸</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å¹¶å‘</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>åšå®¢</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>åˆ†åŒ…ç²˜åŒ…</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å‡½æ•°</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>åŸºå‡†æµ‹è¯•å·¥å…·</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>é¢è¯•</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æ’åº</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å“¨å…µ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æ­»é”</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ç®—æ³•</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>é”æœºåˆ¶</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>é”netty</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å¾®ä¿¡æ”¯ä»˜</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ä½è¿ç®—</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å°ç¨‹åº</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å¼‚å¸¸</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>è¿ç»´</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æ”¯ä»˜å®</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ä¸­é—´ä»¶</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ä¸»ä»</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>centos</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>cer</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Comparable</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Comparator</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>docker</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Erlang</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>FinalAgent</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>frp</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hexo</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>javaè°ƒç”¨c++æ–¹æ³•</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jdk</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>JMH</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>JNA</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>JvisualVm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>JVM</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mongodb</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mysql</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>nodeJs</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>nosql</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>oracle</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pfx</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pycharm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RabbitMQ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>redis</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RSAåˆ†æ®µ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>sql</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>tag2</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>tag3</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="All JAVA "
           href="/2022/09/13/java%E5%AD%A6%E4%B9%A0/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E2%80%94JMH%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"
           data-tag="åŸºå‡†æµ‹è¯•å·¥å…·,JMH"
           data-author="" >
            <span class="post-title" title="JMHä½¿ç”¨æŒ‡å—">JMHä½¿ç”¨æŒ‡å—</span>
            <span class="post-date" title="2022-09-13 00:00:00">2022/09/13</span>
        </a>
        
        <a  class="All mysql "
           href="/2022/06/10/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/mysql/mysql%E8%AF%A6%E8%A7%A3/"
           data-tag="sql,mysql,å‡½æ•°"
           data-author="" >
            <span class="post-title" title="mysqlæ“ä½œ">mysqlæ“ä½œ</span>
            <span class="post-date" title="2022-06-10 00:00:00">2022/06/10</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2022/05/28/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/ide%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E5%8F%8A%E7%A0%B4%E8%A7%A3/pycharm2021.3/"
           data-tag="pycharm,FinalAgent"
           data-author="" >
            <span class="post-title" title="pycharm å®‰è£…åŠç ´è§£">pycharm å®‰è£…åŠç ´è§£</span>
            <span class="post-date" title="2022-05-28 14:16:33">2022/05/28</span>
        </a>
        
        <a  class="All ç®—æ³• "
           href="/2022/03/24/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"
           data-tag="ç®—æ³•,java"
           data-author="" >
            <span class="post-title" title="ç®—æ³•å­¦ä¹ ">ç®—æ³•å­¦ä¹ </span>
            <span class="post-date" title="2022-03-24 14:16:33">2022/03/24</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2021/11/24/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/mongodb/mongodb%E5%AE%89%E8%A3%85%E5%8F%8A%E5%AD%A6%E4%B9%A0/"
           data-tag="mongodb,nosql"
           data-author="" >
            <span class="post-title" title="mongodbå®‰è£…åŠå­¦ä¹ ">mongodbå®‰è£…åŠå­¦ä¹ </span>
            <span class="post-date" title="2021-11-24 00:00:00">2021/11/24</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2021/11/06/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/nodeJs%E4%BD%BF%E7%94%A8/nodeJs%E5%AE%89%E8%A3%85%E5%8F%8A%E5%91%A8%E8%BE%B9%E5%AE%89%E8%A3%85/"
           data-tag="hexo,nodeJs"
           data-author="" >
            <span class="post-title" title="nodeJså®‰è£…åŠå‘¨è¾¹å®‰è£…">nodeJså®‰è£…åŠå‘¨è¾¹å®‰è£…</span>
            <span class="post-date" title="2021-11-06 00:00:00">2021/11/06</span>
        </a>
        
        <a  class="All JAVA "
           href="/2021/06/17/java%E5%AD%A6%E4%B9%A0/jvm/NullPointerException%20%E6%B2%A1%E6%9C%89%E6%89%93%E5%8D%B0%E5%BC%82%E5%B8%B8%E6%A0%88%E9%97%AE%E9%A2%98%E8%BF%BD%E8%B8%AA/"
           data-tag="JVM,å¼‚å¸¸"
           data-author="" >
            <span class="post-title" title="NullPointerException æ²¡æœ‰æ‰“å°å¼‚å¸¸æ ˆé—®é¢˜è¿½è¸ª">NullPointerException æ²¡æœ‰æ‰“å°å¼‚å¸¸æ ˆé—®é¢˜è¿½è¸ª</span>
            <span class="post-date" title="2021-06-17 14:16:33">2021/06/17</span>
        </a>
        
        <a  class="All ä¸­é—´ä»¶ "
           href="/2021/06/05/%E4%B8%AD%E9%97%B4%E4%BB%B6/rabbitmq/RabbitMQ%E4%BD%BF%E7%94%A8/"
           data-tag="ä¸­é—´ä»¶,RabbitMQ"
           data-author="" >
            <span class="post-title" title="RabbitMQ å®æˆ˜">RabbitMQ å®æˆ˜</span>
            <span class="post-date" title="2021-06-05 14:16:33">2021/06/05</span>
        </a>
        
        <a  class="All Linux "
           href="/2021/06/05/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/linux/centos%20%E5%AE%89%E8%A3%85%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E6%94%AF%E6%8C%81/"
           data-tag="RabbitMQ,jdk,Erlang,frp,centos"
           data-author="" >
            <span class="post-title" title="centos å®‰è£…åŸºæœ¬ç¯å¢ƒæ”¯æŒ">centos å®‰è£…åŸºæœ¬ç¯å¢ƒæ”¯æŒ</span>
            <span class="post-date" title="2021-06-05 14:16:33">2021/06/05</span>
        </a>
        
        <a  class="All docker "
           href="/2021/06/05/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/linux/Docker%20%E5%A4%A7%E5%85%A8/"
           data-tag="docker"
           data-author="" >
            <span class="post-title" title="dockerå¤§å…¨">dockerå¤§å…¨</span>
            <span class="post-date" title="2021-06-05 14:16:33">2021/06/05</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2021/05/20/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/redis%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%93%A8%E5%85%B5/redis%E6%90%AD%E5%BB%BA%E4%B8%BB%E4%BB%8E%E5%8F%8A%E5%93%A8%E5%85%B5/"
           data-tag="redis,ä¸»ä»,å“¨å…µ"
           data-author="" >
            <span class="post-title" title="redisæ­å»ºä¸»ä»åŠå“¨å…µ">redisæ­å»ºä¸»ä»åŠå“¨å…µ</span>
            <span class="post-date" title="2021-05-20 14:16:33">2021/05/20</span>
        </a>
        
        <a  class="All JAVA "
           href="/2021/04/21/%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3/%E9%9D%A2%E8%AF%95%E9%A2%98%E6%80%BB%E7%BB%93/"
           data-tag="é¢è¯•"
           data-author="" >
            <span class="post-title" title="é¢è¯•é¢˜">é¢è¯•é¢˜</span>
            <span class="post-date" title="2021-04-21 14:16:33">2021/04/21</span>
        </a>
        
        <a  class="All JAVA "
           href="/2021/04/19/java%E5%AD%A6%E4%B9%A0/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/"
           data-tag="å¹¶å‘,java"
           data-author="" >
            <span class="post-title" title="å¹¶å‘ç¼–ç¨‹å®æˆ˜">å¹¶å‘ç¼–ç¨‹å®æˆ˜</span>
            <span class="post-date" title="2021-04-19 00:00:00">2021/04/19</span>
        </a>
        
        <a  class="All JAVA "
           href="/2021/04/09/java%E5%AD%A6%E4%B9%A0/JNA/%E4%BD%BF%E7%94%A8c%E3%80%81c++%E6%96%B9%E6%B3%95/"
           data-tag="javaè°ƒç”¨c++æ–¹æ³•,JNA"
           data-author="" >
            <span class="post-title" title="JNAçš„ä½¿ç”¨">JNAçš„ä½¿ç”¨</span>
            <span class="post-date" title="2021-04-09 14:16:33">2021/04/09</span>
        </a>
        
        <a  class="All JVM "
           href="/2021/04/09/java%E5%AD%A6%E4%B9%A0/jvm/JvisualVm%E6%8F%90%E7%A4%BA%E6%97%A0%E6%B3%95%E7%9B%91%E8%A7%86%E6%9C%AC%E5%9C%B0Java%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/"
           data-tag="JvisualVm,JVM"
           data-author="" >
            <span class="post-title" title="JvisualVmæç¤ºæ— æ³•ç›‘è§†æœ¬åœ°Javaåº”ç”¨ç¨‹åºè§£å†³åŠæ³•">JvisualVmæç¤ºæ— æ³•ç›‘è§†æœ¬åœ°Javaåº”ç”¨ç¨‹åºè§£å†³åŠæ³•</span>
            <span class="post-date" title="2021-04-09 14:16:33">2021/04/09</span>
        </a>
        
        <a  class="All JAVA "
           href="/2021/04/09/java%E5%AD%A6%E4%B9%A0/jvm/RMI%20TCP%20CONNECTION%20%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98/"
           data-tag="javaè°ƒç”¨c++æ–¹æ³•,JNA"
           data-author="" >
            <span class="post-title" title="JNAçš„ä½¿ç”¨">JNAçš„ä½¿ç”¨</span>
            <span class="post-date" title="2021-04-09 14:16:33">2021/04/09</span>
        </a>
        
        <a  class="All å¹¶å‘ã€netty "
           href="/2021/03/30/netty/netty%E5%88%86%E5%8C%85%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"
           data-tag="é”netty,å¹¶å‘,åˆ†åŒ…ç²˜åŒ…"
           data-author="" >
            <span class="post-title" title="nettyåˆ†åŒ…ç²˜åŒ…é—®é¢˜">nettyåˆ†åŒ…ç²˜åŒ…é—®é¢˜</span>
            <span class="post-date" title="2021-03-30 14:16:33">2021/03/30</span>
        </a>
        
        <a  class="All JAVA "
           href="/2021/03/08/java%E5%AD%A6%E4%B9%A0/%E4%BD%8D%E8%BF%90%E7%AE%97/%E4%BD%8D%E8%BF%90%E7%AE%97/"
           data-tag="æŒ‰ä½ä¸,ä½è¿ç®—"
           data-author="" >
            <span class="post-title" title="ä½è¿ç®—">ä½è¿ç®—</span>
            <span class="post-date" title="2021-03-08 14:16:33">2021/03/08</span>
        </a>
        
        <a  class="All oracle "
           href="/2020/12/17/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/oracle/oracle%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/"
           data-tag="sql,å‡½æ•°,oracle"
           data-author="" >
            <span class="post-title" title="oracleåŸºç¡€è¯­æ³•">oracleåŸºç¡€è¯­æ³•</span>
            <span class="post-date" title="2020-12-17 00:00:00">2020/12/17</span>
        </a>
        
        <a  class="All å¹¶å‘ "
           href="/2020/11/03/%E5%B9%B6%E5%8F%91/Java%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98%E6%80%BB%E7%BB%93/"
           data-tag="å¹¶å‘,é”æœºåˆ¶,æ­»é”"
           data-author="" >
            <span class="post-title" title="Java å¹¶å‘åŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“">Java å¹¶å‘åŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“</span>
            <span class="post-date" title="2020-11-03 14:16:33">2020/11/03</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2020/10/28/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/hexo/hexo%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/"
           data-tag="hexo,åšå®¢"
           data-author="" >
            <span class="post-title" title="hexoæ­å»ºé™æ€åšå®¢">hexoæ­å»ºé™æ€åšå®¢</span>
            <span class="post-date" title="2020-10-28 14:16:33">2020/10/28</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2020/10/28/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/%E8%AF%81%E4%B9%A6/%E8%AF%81%E4%B9%A6%E8%BD%AC%E6%8D%A2/"
           data-tag="pfx,cer"
           data-author="" >
            <span class="post-title" title="è¯ä¹¦è½¬æ¢">è¯ä¹¦è½¬æ¢</span>
            <span class="post-date" title="2020-10-28 14:16:33">2020/10/28</span>
        </a>
        
        <a  class="All JAVA "
           href="/2020/10/27/java%E5%AD%A6%E4%B9%A0/%E5%B7%A5%E5%85%B7%E5%8C%85%E5%AD%A6%E4%B9%A0/Comparable%E4%B8%8EComparator/"
           data-tag="Comparable,Comparator,æ’åº"
           data-author="" >
            <span class="post-title" title="Comparableä¸Comparator">Comparableä¸Comparator</span>
            <span class="post-date" title="2020-10-27 14:16:33">2020/10/27</span>
        </a>
        
        <a  class="All å°ç¨‹åº "
           href="/2020/10/21/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9B%B8%E5%85%B3/rsa%E5%88%86%E6%AE%B5%E5%8A%A0%E5%AF%86(%E5%B0%8F%E7%A8%8B%E5%BA%8F+java%E5%90%8E%E5%8F%B0)/"
           data-tag="å°ç¨‹åº,RSAåˆ†æ®µ"
           data-author="" >
            <span class="post-title" title="rsaåˆ†æ®µåŠ å¯†ï¼ˆå°ç¨‹åº+javaåå°ï¼‰">rsaåˆ†æ®µåŠ å¯†ï¼ˆå°ç¨‹åº+javaåå°ï¼‰</span>
            <span class="post-date" title="2020-10-21 14:16:33">2020/10/21</span>
        </a>
        
        <a  class="All å¹¶å‘ "
           href="/2020/10/21/%E5%B9%B6%E5%8F%91/%E6%82%B2%E8%A7%82%E9%94%81%E4%B8%8E%E4%B9%90%E8%A7%82%E9%94%81/"
           data-tag="å¹¶å‘,é”æœºåˆ¶"
           data-author="" >
            <span class="post-title" title="æ‚²è§‚é”ä¸ä¹è§‚é”">æ‚²è§‚é”ä¸ä¹è§‚é”</span>
            <span class="post-date" title="2020-10-21 14:16:33">2020/10/21</span>
        </a>
        
        <a  class="All oracle "
           href="/2020/10/21/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/oracle/oracle%20%E8%AF%AF%E5%88%A0%E6%95%B0%E6%8D%AE%E3%80%81%E8%A1%A8%E7%9A%84%E6%81%A2%E5%A4%8D/"
           data-tag="è¿ç»´,tag2,tag3"
           data-author="" >
            <span class="post-title" title="oracle è¯¯åˆ æ•°æ®ã€è¡¨çš„æ¢å¤">oracle è¯¯åˆ æ•°æ®ã€è¡¨çš„æ¢å¤</span>
            <span class="post-date" title="2020-10-21 14:16:33">2020/10/21</span>
        </a>
        
        <a  class="All å·¥å…· "
           href="/2020/03/25/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98%E6%8B%89%E8%B5%B7%E6%B5%81%E7%A8%8B/%E8%81%9A%E5%90%88%E6%94%AF%E4%BB%98%E6%B5%81%E7%A8%8B/"
           data-tag="å¾®ä¿¡æ”¯ä»˜,æ”¯ä»˜å®"
           data-author="" >
            <span class="post-title" title="èšåˆæ”¯ä»˜">èšåˆæ”¯ä»˜</span>
            <span class="post-date" title="2020-03-25 14:16:33">2020/03/25</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-javaå­¦ä¹ /æ€§èƒ½ä¼˜åŒ–/åŸºå‡†æµ‹è¯•å·¥å…·â€”JMHä½¿ç”¨æŒ‡å—" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">JMHä½¿ç”¨æŒ‡å—</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="JAVA">JAVA</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">åŸºå‡†æµ‹è¯•å·¥å…·</a>
            
            <a class="color4">JMH</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2022-09-14 17:30:46'>2022-09-13 00:00</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7-%E2%80%94%E2%80%94-JMH%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97"><span class="toc-text">JavaåŸºå‡†æµ‹è¯•å·¥å…· â€”â€” JMHä½¿ç”¨æŒ‡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E7%A1%80"><span class="toc-text">ä¸€ã€åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Java-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E9%9A%BE%E9%A2%98"><span class="toc-text">1.1 Java æ€§èƒ½æµ‹è¯•éš¾é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%9B%B8%E5%85%B3%E7%BD%91%E7%AB%99"><span class="toc-text">1.2 ç›¸å…³ç½‘ç«™</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8"><span class="toc-text">äºŒã€ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%BC%95%E5%8C%85"><span class="toc-text">2.1 å¼•åŒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-text">2.2 åˆ›å»ºæµ‹è¯•ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E8%AF%A6%E8%A7%A3"><span class="toc-text">2.3 è¾“å‡ºç»“æœè¯¦è§£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%AF%A6%E7%BB%86%E5%8F%82%E6%95%B0"><span class="toc-text">ä¸‰ã€è¯¦ç»†å‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Benchmark"><span class="toc-text">@Benchmark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Warmup"><span class="toc-text">@Warmup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Measurement"><span class="toc-text">@Measurement</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BenchmarkMode"><span class="toc-text">@BenchmarkMode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OutputTimeUnit"><span class="toc-text">@OutputTimeUnit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#State"><span class="toc-text">@State</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Param"><span class="toc-text">@Param</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fork"><span class="toc-text">@Fork</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Threads"><span class="toc-text">@Threads</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81JMH-%E8%BF%9B%E9%98%B6"><span class="toc-text">å››ã€JMH è¿›é˜¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%94%A8%E4%BB%A3%E7%A0%81%E6%B6%88%E9%99%A4-%EF%BC%88-Dead-Code-Elimination-%EF%BC%89"><span class="toc-text">æ— ç”¨ä»£ç æ¶ˆé™¤ ï¼ˆ Dead Code Elimination ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blackhole-%E9%BB%91%E6%B4%9E"><span class="toc-text">** Blackhole (é»‘æ´)**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DCE%E7%9A%84%E5%B8%B8%E9%87%8F%E6%8A%98%E5%8F%A0%EF%BC%88constant-folding%EF%BC%89"><span class="toc-text">DCEçš„å¸¸é‡æŠ˜å ï¼ˆconstant-foldingï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E5%B1%95%E5%BC%80%EF%BC%88Loop-Unwinding%EF%BC%89"><span class="toc-text">** å¾ªç¯å±•å¼€ï¼ˆLoop Unwindingï¼‰**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%86%85%E8%81%94"><span class="toc-text">æ–¹æ³•å†…è”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">å‚è€ƒ</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JavaåŸºå‡†æµ‹è¯•å·¥å…·-â€”â€”-JMHä½¿ç”¨æŒ‡å—"><a href="#JavaåŸºå‡†æµ‹è¯•å·¥å…·-â€”â€”-JMHä½¿ç”¨æŒ‡å—" class="headerlink" title="JavaåŸºå‡†æµ‹è¯•å·¥å…· â€”â€” JMHä½¿ç”¨æŒ‡å—"></a>JavaåŸºå‡†æµ‹è¯•å·¥å…· â€”â€” JMHä½¿ç”¨æŒ‡å—</h1><h2 id="ä¸€ã€åŸºç¡€"><a href="#ä¸€ã€åŸºç¡€" class="headerlink" title="ä¸€ã€åŸºç¡€"></a>ä¸€ã€åŸºç¡€</h2><p>JMHï¼ˆJava Microbenchmark Harnessï¼‰æ˜¯Javaç”¨æ¥åšåŸºå‡†æµ‹è¯•ä¸€ä¸ªå·¥å…·ï¼Œè¯¥å·¥å…·ç”±<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=openJDK&spm=1001.2101.3001.7020">openJDK</a>æä¾›å¹¶ç»´æŠ¤ï¼Œç²¾åº¦å¯ä»¥è¾¾åˆ°çº³ç§’çº§ã€‚è¯¥å·¥å…·æ˜¯ç”± Oracle å†…éƒ¨å®ç° JIT çš„å¤§ç‰›ä»¬ç¼–å†™çš„ï¼Œä»–ä»¬åº”è¯¥æ¯”ä»»ä½•äººéƒ½äº†è§£ JIT ä»¥åŠ JVM å¯¹äºåŸºå‡†æµ‹è¯•çš„å½±å“ã€‚</p>
<h3 id="1-1-Java-æ€§èƒ½æµ‹è¯•éš¾é¢˜"><a href="#1-1-Java-æ€§èƒ½æµ‹è¯•éš¾é¢˜" class="headerlink" title="1.1 Java æ€§èƒ½æµ‹è¯•éš¾é¢˜"></a>1.1 Java æ€§èƒ½æµ‹è¯•éš¾é¢˜</h3><p>ç°åœ¨çš„ JVM å·²ç»è¶Šæ¥è¶Šä¸ºæ™ºèƒ½ï¼Œå®ƒå¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µã€åŠ è½½é˜¶æ®µã€è¿è¡Œé˜¶æ®µå¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚æ¯”å¦‚ä½ å†™äº†ä¸€æ®µä¸æ€ä¹ˆèªæ˜çš„ä»£ç ï¼Œåˆ°äº† JVM è¿™é‡Œï¼Œå®ƒå‘ç°å‡ å¤„å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œå°±é¡ºæ‰‹å¸®ä½ ä¼˜åŒ–äº†ä¸€æŠŠã€‚è¿™å¯¹ç¨‹åºçš„è¿è¡Œå›ºç„¶ç¾å¦™ï¼Œå´è®©å¼€å‘è€…ä¸èƒ½å‡†ç¡®äº†è§£ç¨‹åºçš„è¿è¡Œæƒ…å†µã€‚åœ¨éœ€è¦è¿›è¡Œæ€§èƒ½æµ‹è¯•æ—¶ï¼Œå¦‚æœä¸çŸ¥é“ JVM ä¼˜åŒ–ç»†èŠ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ çš„æµ‹è¯•ç»“æœå·®ä¹‹æ¯«å˜ï¼Œå¤±ä¹‹åƒé‡Œï¼ŒåŒæ ·çš„ï¼ŒJava è¯ç”Ÿä¹‹åˆå°±æœ‰ä¸€æ¬¡ç¼–è¯‘ã€éšå¤„è¿è¡Œçš„å£å·ï¼ŒJVM æä¾›äº†åº•å±‚æ”¯æŒï¼Œä¹Ÿæä¾›äº†å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œè¿™äº›æœºåˆ¶éƒ½ä¼šå¯¹æˆ‘ä»¬çš„æ€§èƒ½æµ‹è¯•ç»“æœé€ æˆä¸å¯é¢„æµ‹çš„å½±å“ã€‚</p>
<pre><code class="java">long start = System.currentTimeMillis();
// ....
long end = System.currentTimeMillis();
System.out.println(end - start);
</code></pre>
<p>ä¸Šé¢å¯èƒ½å°±æ˜¯ä½ æœ€å¸¸è§çš„æ€§èƒ½æµ‹è¯•äº†ï¼Œè¿™æ ·çš„æµ‹è¯•ç»“æœçœŸçš„å‡†ç¡®å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå®ƒæœ‰ä¸‹é¢å‡ ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>æ—¶é—´ç²¾åº¦é—®é¢˜ï¼Œæœ¬èº«è·å–åˆ°çš„æ—¶é—´æˆ³å°±æ˜¯å­˜åœ¨<strong>è¯¯å·®</strong>çš„ï¼Œå®ƒå’Œæ“ä½œç³»ç»Ÿæœ‰å…³ã€‚</li>
<li>JVM åœ¨è¿è¡Œæ—¶ä¼šè¿›è¡Œ<strong>ä»£ç é¢„çƒ­</strong>ï¼Œè¯´ç™½äº†å°±æ˜¯<strong>è¶Šè·‘è¶Šå¿«</strong>ã€‚å› ä¸ºç±»éœ€è¦è£…è½½ã€éœ€è¦å‡†å¤‡æ“ä½œã€‚</li>
<li>JVM ä¼šåœ¨å„ä¸ªé˜¶æ®µéƒ½æœ‰å¯èƒ½å¯¹ä½ çš„ä»£ç è¿›è¡Œ<strong>ä¼˜åŒ–å¤„ç†</strong>ã€‚</li>
<li><strong>èµ„æºå›æ”¶</strong>çš„ä¸ç¡®å®šæ€§ï¼Œå¯èƒ½è¿è¡Œå¾ˆå¿«ï¼Œå›æ”¶å¾ˆæ…¢ã€‚</li>
</ol>
<p>å¸¦ç€è¿™äº›é—®é¢˜ï¼Œçªç„¶å‘ç°è¿›è¡Œä¸€æ¬¡ä¸¥æ ¼çš„åŸºå‡†æµ‹è¯•çš„éš¾åº¦å¤§å¤§å¢åŠ ã€‚é‚£ä¹ˆå¦‚ä½•æ‰èƒ½è¿›è¡Œä¸€æ¬¡ä¸¥æ ¼çš„åŸºå‡†æµ‹è¯•å‘¢ï¼Ÿ</p>
<p> <strong>JMHåªé€‚åˆç»†ç²’åº¦çš„æ–¹æ³•æµ‹è¯•ï¼Œå¹¶ä¸é€‚ç”¨äºç³»ç»Ÿä¹‹é—´çš„é“¾è·¯æµ‹è¯•ï¼</strong></p>
<h3 id="1-2-ç›¸å…³ç½‘ç«™"><a href="#1-2-ç›¸å…³ç½‘ç«™" class="headerlink" title="1.2 ç›¸å…³ç½‘ç«™"></a>1.2 ç›¸å…³ç½‘ç«™</h3><ul>
<li><a target="_blank" rel="noopener" href="http://openjdk.java.net/projects/code-tools/jmh">JMH å®˜ç½‘</a></li>
<li><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples">JMH å®˜æ–¹ç”¨ä¾‹</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Childe-Chen/goodGoodStudy/tree/master/src/main/java/com/cxd/benchmark">JMH å®˜æ–¹ç”¨ä¾‹ ç¿»è¯‘</a></li>
</ul>
<h2 id="äºŒã€ä½¿ç”¨"><a href="#äºŒã€ä½¿ç”¨" class="headerlink" title="äºŒã€ä½¿ç”¨"></a>äºŒã€ä½¿ç”¨</h2><h3 id="2-1-å¼•åŒ…"><a href="#2-1-å¼•åŒ…" class="headerlink" title="2.1 å¼•åŒ…"></a>2.1 å¼•åŒ…</h3><pre><code class="xml">&lt;!--jmh åŸºå‡†æµ‹è¯• --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;
    &lt;artifactId&gt;jmh-core&lt;/artifactId&gt;
    &lt;version&gt;1.23&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;
    &lt;artifactId&gt;jmh-generator-annprocess&lt;/artifactId&gt;
    &lt;version&gt;1.23&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="2-2-åˆ›å»ºæµ‹è¯•ç±»"><a href="#2-2-åˆ›å»ºæµ‹è¯•ç±»" class="headerlink" title="2.2 åˆ›å»ºæµ‹è¯•ç±»"></a>2.2 åˆ›å»ºæµ‹è¯•ç±»</h3><p>ä»¥ä¸‹ä»¥ <strong>jackson</strong> è½¬æ¢jsonä¸ºä¾‹</p>
<pre><code class="java">@BenchmarkMode(Mode.Throughput) // æµ‹è¯•æ¨¡å¼: è®¡ç®—ååé‡
@State(Scope.Thread) // ç±»å®ä¾‹çš„å¯ç”¨èŒƒå›´ é»˜è®¤çŠ¶æ€ã€‚æ¯ä¸ªæµ‹è¯•çº¿ç¨‹åˆ†é…ä¸€ä¸ªå®ä¾‹ï¼›
@OutputTimeUnit(TimeUnit.SECONDS) // è¾“å‡ºæ—¶é—´å•ä½
@Warmup(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS) // æµ‹è¯•å‰è¿›è¡Œä¸‰æ¬¡é¢„çƒ­æ‰§è¡Œ
@Measurement(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS) // 5 æ¬¡å¾®åŸºå‡†æµ‹è¯•
@Fork(1) // å¼€å¯ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œæµ‹è¯•
@Threads(10) // æµ‹è¯•ä½¿ç”¨çš„çº¿ç¨‹æ•°
public class MyBenchmark &#123;

    String string = &quot;&quot;;
    StringBuilder stringBuilder = new StringBuilder();

    String json = &quot;&#123; \&quot;color\&quot; : \&quot;Black\&quot;, \&quot;type\&quot; : \&quot;BMW\&quot; &#125;&quot;;

    @State(Scope.Benchmark) // æ‰€æœ‰æµ‹è¯•çº¿ç¨‹å…±äº«ä¸€ä¸ªå®ä¾‹ï¼Œç”¨äºæµ‹è¯•æœ‰çŠ¶æ€å®ä¾‹åœ¨å¤šçº¿ç¨‹å…±äº«ä¸‹çš„æ€§èƒ½ï¼›
    public static class BenchmarkState &#123;
        ObjectMapper GLOBAL_MAP = new ObjectMapper();
        ThreadLocal&lt;ObjectMapper&gt; GLOBAL_MAP_THREAD = new ThreadLocal&lt;&gt;();
    &#125;

    @Benchmark // æ ‡è®°æµ‹è¯•æ–¹æ³• ä»…public
    public Map globalTest(BenchmarkState state) throws Exception&#123;
        return state.GLOBAL_MAP.readValue(json, Map.class);
    &#125;

    @Benchmark
    public Map globalTestThreadLocal(BenchmarkState state) throws Exception&#123;
        if(null == state.GLOBAL_MAP_THREAD.get())&#123;
            state.GLOBAL_MAP_THREAD.set(new ObjectMapper());
        &#125;
        return state.GLOBAL_MAP_THREAD.get().readValue(json, Map.class);
    &#125;

    @Benchmark
    public Map localTest() throws Exception&#123;
        ObjectMapper objectMapper = new ObjectMapper();
        return objectMapper.readValue(json, Map.class);
    &#125;

    public static void main(String[] args) throws RunnerException &#123;
        // æ„å»ºè¿è¡Œå‚æ•°, ç±»æ³¨è§£ä¹Ÿå¯ä»¥é€šè¿‡æ­¤å¤„æ„é€ , ä¸”mainæ–¹æ³•çš„ä¼˜å…ˆçº§æ›´é«˜
        Options opt = new OptionsBuilder()
                .include(MyBenchmark.class.getSimpleName())
                .resultFormat(ResultFormatType.CSV) // ç”Ÿæˆæµ‹è¯•ç»“æœ(é»˜è®¤åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹)
                .build();
        new Runner(opt).run();
    &#125;   
&#125;
</code></pre>
<h3 id="2-3-è¾“å‡ºç»“æœè¯¦è§£"><a href="#2-3-è¾“å‡ºç»“æœè¯¦è§£" class="headerlink" title="2.3 è¾“å‡ºç»“æœè¯¦è§£"></a>2.3 è¾“å‡ºç»“æœè¯¦è§£</h3><pre><code class="shell"># JMH version: 1.23
# VM version: JDK 1.8.0_211, Java HotSpot(TM) 64-Bit Server VM, 25.211-b12
# VM invoker: D:\xxx\java.exe
# VM options: -javaagent:xxx\IntelliJ IDEA 2021.2.3\bin -Dfile.encoding=UTF-8
# Warmup: 5 iterations, 1 s each  // é¢„çƒ­è¿è¡Œ5æ¬¡
# Measurement: 5 iterations, 1 s each  // æ€§èƒ½æµ‹è¯•5æ¬¡ 
# Timeout: 10 min per iteration  // è¶…æ—¶æ—¶é—´10åˆ†é’Ÿ
# Threads: 10 threads, will synchronize iterations // çº¿ç¨‹æ•°é‡ä¸º10
# Benchmark mode: Throughput, ops/time // åŸºå‡†æ¨¡å¼ ååé‡  æ¯ç§’æ‰§è¡Œå¤šå°‘æ¬¡
# Benchmark: com.rabbitmqprovider.MyBenchmark.globalTest  // æœ¬æ¬¡æ‰§è¡Œçš„æ–¹æ³•

# Run progress: 0.00% complete, ETA 00:00:30
# Fork: 1 of 1
# Warmup Iteration   1: 9206522.065 ops/s // ç¬¬ä¸€æ¬¡é¢„çƒ­ï¼Œæ¯ç§’æ‰§è¡Œ 
# Warmup Iteration   2: 12471685.637 ops/s
# Warmup Iteration   3: 12555179.271 ops/s
# Warmup Iteration   4: 12972906.601 ops/s
# Warmup Iteration   5: 12724755.463 ops/s
Iteration   1: 12394864.584 ops/s  // æ‰§è¡Œäº”æ¬¡
Iteration   2: 12203348.918 ops/s
Iteration   3: 12755029.102 ops/s
Iteration   4: 12265201.730 ops/s
Iteration   5: 12458625.163 ops/s


Result &quot;com.rabbitmqprovider.MyBenchmark.globalTest&quot;:
  12415413.899 Â±(99.9%) 828477.530 ops/s [Average]
  (min, avg, max) = (12203348.918, 12415413.899, 12755029.102), stdev = 215152.984  // æ‰§è¡Œçš„æœ€å°ã€å¹³å‡ã€æœ€å¤§ã€è¯¯å·®å€¼
  CI (99.9%): [11586936.369, 13243891.430] (assumes normal distribution)

....

# Run complete. Total time: 00:00:35

REMEMBER: The numbers below are just data. To gain reusable insights, you need to follow up on
why the numbers are the way they are. Use profilers (see -prof, -lprof), design factorial
experiments, perform baseline and negative tests that provide experimental control, make sure
the benchmarking environment is safe on JVM/OS/HW level, ask for reviews from the domain experts.
Do not assume the numbers tell you what you want them to tell.
// æµ‹è¯•ç»“æœå¯¹æ¯”
// æµ‹è¯•æ–¹æ³•                        æµ‹è¯•æ¨¡å¼ æ¬¡æ•°          åˆ†æ•°          è¯¯å·®    å•ä½
Benchmark                           Mode  Cnt         Score         Error  Units
MyBenchmark.globalTest             thrpt    5  12415413.899 Â±  828477.530  ops/s
MyBenchmark.globalTestThreadLocal  thrpt    5  12272055.351 Â± 1172156.668  ops/s
MyBenchmark.localTest              thrpt    5    860593.965 Â±  164589.608  ops/s

Benchmark result is saved to jmh-result.csv

Process finished with exit code 0
</code></pre>
<p>é¢„çƒ­ï¼Ÿä¸ºä»€ä¹ˆè¦é¢„çƒ­ï¼Ÿå› ä¸º JVM çš„ JIT æœºåˆ¶çš„å­˜åœ¨ï¼Œå¦‚æœæŸä¸ªå‡½æ•°è¢«è°ƒç”¨å¤šæ¬¡ä¹‹åï¼ŒJVM ä¼šå°è¯•å°†å…¶ç¼–è¯‘æˆä¸ºæœºå™¨ç ä»è€Œæé«˜æ‰§è¡Œé€Ÿåº¦ã€‚ä¸ºäº†è®© benchmark çš„ç»“æœæ›´åŠ æ¥è¿‘çœŸå®æƒ…å†µå°±éœ€è¦è¿›è¡Œé¢„çƒ­ã€‚</p>
<h2 id="ä¸‰ã€è¯¦ç»†å‚æ•°"><a href="#ä¸‰ã€è¯¦ç»†å‚æ•°" class="headerlink" title="ä¸‰ã€è¯¦ç»†å‚æ•°"></a>ä¸‰ã€è¯¦ç»†å‚æ•°</h2><h3 id="Benchmark"><a href="#Benchmark" class="headerlink" title="@Benchmark"></a><strong>@Benchmark</strong></h3><p>@Benchmarkæ ‡ç­¾æ˜¯ç”¨æ¥æ ‡è®°æµ‹è¯•æ–¹æ³•çš„ï¼Œåªæœ‰è¢«è¿™ä¸ªæ³¨è§£æ ‡è®°çš„è¯ï¼Œè¯¥æ–¹æ³•æ‰ä¼šå‚ä¸åŸºå‡†æµ‹è¯•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªåŸºæœ¬çš„åŸåˆ™å°±æ˜¯è¢«@Benchmarkæ ‡è®°çš„æ–¹æ³•å¿…é¡»æ˜¯publicçš„ã€‚</p>
<h3 id="Warmup"><a href="#Warmup" class="headerlink" title="@Warmup"></a><strong>@Warmup</strong></h3><p>@Warmupç”¨æ¥é…ç½®é¢„çƒ­çš„å†…å®¹ï¼Œå¯ç”¨äºç±»æˆ–è€…æ–¹æ³•ä¸Šï¼Œè¶Šé è¿‘æ‰§è¡Œæ–¹æ³•çš„åœ°æ–¹è¶Šå‡†ç¡®ã€‚ä¸€èˆ¬é…ç½®warmupçš„å‚æ•°æœ‰è¿™äº›ï¼š</p>
<ul>
<li>iterationsï¼šé¢„çƒ­çš„æ¬¡æ•°ã€‚</li>
<li>timeï¼šæ¯æ¬¡é¢„çƒ­çš„æ—¶é—´ã€‚</li>
<li>timeUnitï¼šæ—¶é—´å•ä½ï¼Œé»˜è®¤æ˜¯sã€‚</li>
<li>batchSize: æ‰¹å¤„ç†å¤§å°ï¼Œæ¯æ¬¡æ“ä½œè°ƒç”¨å‡ æ¬¡æ–¹æ³•ã€‚</li>
</ul>
<h3 id="Measurement"><a href="#Measurement" class="headerlink" title="@Measurement"></a><strong>@Measurement</strong></h3><p>ç”¨æ¥æ§åˆ¶å®é™…æ‰§è¡Œçš„å†…å®¹ï¼Œé…ç½®çš„é€‰é¡¹æœ¬warmupä¸€æ ·ã€‚</p>
<ul>
<li>iteration:  è¿­ä»£æ¬¡æ•°</li>
<li>time: æ¯æ¬¡æµ‹é‡è¿­ä»£çš„æ—¶é•¿</li>
<li>timeUnit: æ¯æ¬¡æµ‹é‡è¿­ä»£çš„æ—¶é•¿å•ä½</li>
<li>batchSize: æ¯æ¬¡æ“ä½œåŸºå‡†æ–¹æ³•çš„è°ƒç”¨æ•°</li>
</ul>
<h3 id="BenchmarkMode"><a href="#BenchmarkMode" class="headerlink" title="@BenchmarkMode"></a><strong>@BenchmarkMode</strong></h3><p>@BenchmarkModeä¸»è¦æ˜¯è¡¨ç¤ºæµ‹é‡çš„çº¬åº¦ï¼Œæœ‰ä»¥ä¸‹è¿™äº›çº¬åº¦å¯ä¾›é€‰æ‹©ï¼š</p>
<ul>
<li>Mode.Throughput ååé‡</li>
<li>Mode.AverageTime å¹³å‡æ—¶é—´</li>
<li>Mode.SampleTime æŠ½æ ·æ£€æµ‹</li>
<li>Mode.SingleShotTime æ£€æµ‹ä¸€æ¬¡è°ƒç”¨</li>
<li>Mode.All è¿ç”¨æ‰€æœ‰çš„æ£€æµ‹æ¨¡å¼ åœ¨æ–¹æ³•çº§åˆ«æŒ‡å®š@BenchmarkModeçš„æ—¶å€™å¯ä»¥ä¸€å®šæŒ‡å®šå¤šä¸ªçº¬åº¦ï¼Œä¾‹å¦‚ï¼š @BenchmarkMode({Mode.Throughput, Mode.AverageTime, Mode.SampleTime, Mode.SingleShotTime})ï¼Œä»£è¡¨åŒæ—¶åœ¨å¤šä¸ªçº¬åº¦å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œæµ‹é‡ã€‚</li>
</ul>
<h3 id="OutputTimeUnit"><a href="#OutputTimeUnit" class="headerlink" title="@OutputTimeUnit"></a><strong>@OutputTimeUnit</strong></h3><p>@OutputTimeUnitä»£è¡¨æµ‹é‡çš„å•ä½ï¼Œæ¯”å¦‚ç§’çº§åˆ«ï¼Œæ¯«ç§’çº§åˆ«ï¼Œå¾®å¦™çº§åˆ«ç­‰ç­‰ã€‚ä¸€èˆ¬éƒ½ä½¿ç”¨å¾®å¦™å’Œæ¯«ç§’çº§åˆ«çš„ç¨å¾®å¤šä¸€ç‚¹ã€‚è¯¥æ³¨è§£å¯ä»¥ç”¨åœ¨æ–¹æ³•çº§åˆ«å’Œç±»çº§åˆ«ï¼Œå½“ç”¨åœ¨ç±»çº§åˆ«çš„æ—¶å€™ä¼šè¢«æ›´åŠ ç²¾ç¡®çš„æ–¹æ³•çº§åˆ«çš„æ³¨è§£è¦†ç›–ï¼ŒåŸåˆ™å°±æ˜¯ç¦»ç›®æ ‡æ›´è¿‘çš„æ³¨è§£æ›´å®¹æ˜“ç”Ÿæ•ˆã€‚</p>
<h3 id="State"><a href="#State" class="headerlink" title="@State"></a><strong>@State</strong></h3><p>åœ¨å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€äº›çŠ¶æ€å†…å®¹ï¼Œæ¯”å¦‚åœ¨å¤šçº¿ç¨‹çš„æ—¶å€™æˆ‘ä»¬ä¼šç»´æŠ¤ä¸€ä¸ªå…±äº«çš„çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å€¼å¯èƒ½ä¼šåœ¨æ¯éš”çº¿ç¨‹ä¸­éƒ½ä¸€æ ·ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„çŠ¶æ€ï¼ŒJMHä¸ºæˆ‘ä»¬æä¾›äº†çŠ¶æ€çš„æ”¯æŒã€‚è¯¥æ³¨è§£åªèƒ½ç”¨æ¥æ ‡æ³¨åœ¨ç±»ä¸Šï¼Œå› ä¸ºç±»ä½œä¸ºä¸€ä¸ªå±æ€§çš„è½½ä½“ã€‚ @Stateçš„çŠ¶æ€å€¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>Scope.Benchmark è¯¥çŠ¶æ€çš„æ„æ€æ˜¯ä¼šåœ¨æ‰€æœ‰çš„Benchmarkçš„å·¥ä½œçº¿ç¨‹ä¸­å…±äº«å˜é‡å†…å®¹ã€‚</li>
<li>Scope.Group åŒä¸€ä¸ªGroupçš„çº¿ç¨‹å¯ä»¥äº«æœ‰åŒæ ·çš„å˜é‡</li>
<li>Scope.Thread æ¯éš”çº¿ç¨‹éƒ½äº«æœ‰ä¸€ä»½å˜é‡çš„å‰¯æœ¬ï¼Œçº¿ç¨‹ä¹‹é—´å¯¹äºå˜é‡çš„ä¿®æ”¹ä¸ä¼šç›¸äº’å½±å“ã€‚ </li>
</ul>
<p>å¿…é¡»éµå¾ªä»¥ä¸‹å››æ¡è§„åˆ™ï¼š</p>
<ul>
<li>æœ‰æ— å‚æ„é€ å‡½æ•°(é»˜è®¤æ„é€ å‡½æ•°)</li>
<li>å¿…é¡»å…¬å…±ç±»</li>
<li>å¦‚æœæ˜¯å†…éƒ¨ç±»ï¼Œéœ€è¦æ˜¯é™æ€å†…éƒ¨ç±»</li>
<li>å¿…é¡»ä½¿ç”¨ @State æ³¨è§£</li>
</ul>
<pre><code class="java">1.ç›´æ¥åœ¨å†…éƒ¨ç±»ä¸­ä½¿ç”¨@Stateä½œä¸ºâ€œPropertyHolderâ€

public class JMHSample_03_States &#123;

    @State(Scope.Benchmark)
    public static class BenchmarkState &#123;
        volatile double x = Math.PI;
    &#125;

    @State(Scope.Thread)
    public static class ThreadState &#123;
        volatile double x = Math.PI;
    &#125;

    @Benchmark
    public void measureUnshared(ThreadState state) &#123;
        state.x++;
    &#125;

    @Benchmark
    public void measureShared(BenchmarkState state) &#123;
        state.x++;
    &#125;

    public static void main(String[] args) throws RunnerException &#123;
        Options opt = new OptionsBuilder()
                .include(JMHSample_03_States.class.getSimpleName())
                .threads(4)
                .forks(1)
                .build();

        new Runner(opt).run();
    &#125;
&#125;

2.åœ¨Mainç±»ä¸­ç›´æ¥ä½¿ç”¨@Stateä½œä¸ºæ³¨è§£ï¼Œæ˜¯Mainç±»ç›´æ¥æˆä¸ºâ€œPropertyHolderâ€
@State(Scope.Thread)
public class JMHSample_04_DefaultState &#123;
    double x = Math.PI;

    @Benchmark
    public void measure() &#123;
        x++;
    &#125;

    public static void main(String[] args) throws RunnerException &#123;
        Options opt = new OptionsBuilder()
                .include(JMHSample_04_DefaultState.class.getSimpleName())
                .forks(1)
                .build();

        new Runner(opt).run();
    &#125;
&#125;
</code></pre>
<p>æˆ‘ä»¬è¯•æƒ³ä»¥ä¸‹@Stateçš„å«ä¹‰ï¼Œå®ƒä¸»è¦æ˜¯æ–¹ä¾¿æ¡†æ¶æ¥æ§åˆ¶å˜é‡çš„è¿‡ç¨‹é€»è¾‘ï¼Œé€šè¿‡@Stateæ ‡ç¤ºçš„ç±»éƒ½è¢«ç”¨ä½œå±æ€§çš„å®¹å™¨ï¼Œç„¶åæ¡†æ¶å¯ä»¥é€šè¿‡è‡ªå·±çš„æ§åˆ¶æ¥é…ç½®ä¸åŒçº§åˆ«çš„éš”ç¦»æƒ…å†µã€‚è¢«@Benchmarkæ ‡æ³¨çš„æ–¹æ³•å¯ä»¥æœ‰å‚æ•°ï¼Œä½†æ˜¯å‚æ•°å¿…é¡»æ˜¯è¢«@Stateæ³¨è§£çš„ï¼Œå°±æ˜¯ä¸ºäº†è¦æ§åˆ¶å‚æ•°çš„éš”ç¦»ã€‚</p>
<p>ä½†æ˜¯æœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å¯¹å‚æ•°è¿›è¡Œä¸€äº›åˆå§‹åŒ–æˆ–è€…é‡Šæ”¾çš„æ“ä½œï¼Œå°±åƒSpringæä¾›çš„ä¸€äº›initå’Œdestoryæ–¹æ³•ä¸€æ ·ï¼ŒJHMä¹Ÿæä¾›æœ‰è¿™æ ·çš„é’©å­ï¼š</p>
<ul>
<li>@Setup å¿…é¡»æ ‡ç¤ºåœ¨@Stateæ³¨è§£çš„ç±»å†…éƒ¨ï¼Œè¡¨ç¤ºåˆå§‹åŒ–æ“ä½œ</li>
<li>@TearDown å¿…é¡»è¡¨ç¤ºåœ¨@Stateæ³¨è§£çš„ç±»å†…éƒ¨ï¼Œè¡¨ç¤ºé”€æ¯æ“ä½œ</li>
</ul>
<p>åˆå§‹åŒ–å’Œé”€æ¯çš„åŠ¨ä½œéƒ½åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<pre><code class="text">@State(Scope.Thread)
public class JMHSample_05_StateFixtures &#123;
    double x;

    @Setup
    public void prepare() &#123;
        x = Math.PI;
    &#125;

    @TearDown
    public void check() &#123;
        assert x &gt; Math.PI : &quot;Nothing changed?&quot;;
    &#125;

    @Benchmark
    public void measureRight() &#123;
        x++;
    &#125;

    public static void main(String[] args) throws RunnerException &#123;
        Options opt = new OptionsBuilder()
                .include(JMHSample_05_StateFixtures.class.getSimpleName())
                .forks(1)
                .jvmArgs(&quot;-ea&quot;)
                .build();

        new Runner(opt).run();
    &#125;
&#125;
</code></pre>
<p>è™½ç„¶æˆ‘ä»¬å¯ä»¥æ‰§è¡Œåˆå§‹åŒ–å’Œé”€æ¯çš„åŠ¨ä½œï¼Œä½†æ˜¯æ€»æ˜¯æ„Ÿè§‰è¿˜ç¼ºç‚¹å•¥ï¼Ÿå¯¹ï¼Œå°±æ˜¯åˆå§‹åŒ–çš„ç²’åº¦ã€‚å› ä¸ºåŸºå‡†æµ‹è¯•å¾€å¾€ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½ä¿è¯æ¯æ¬¡æ‰§è¡Œæ–¹æ³•çš„æ—¶å€™éƒ½åˆå§‹åŒ–ä¸€æ¬¡å˜é‡å‘¢ï¼Ÿ @Setupå’Œ@TearDownæä¾›äº†ä»¥ä¸‹ä¸‰ç§çº¬åº¦çš„æ§åˆ¶ï¼š</p>
<ul>
<li>Level.Trial åªä¼šåœ¨ä¸ªåŸºç¡€æµ‹è¯•çš„å‰åæ‰§è¡Œã€‚åŒ…æ‹¬Warmupå’ŒMeasurementé˜¶æ®µï¼Œä¸€å…±åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</li>
<li>Level.Iteration æ¯æ¬¡æ‰§è¡Œè®°ä½æµ‹è¯•æ–¹æ³•çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œï¼Œå¦‚æœWarmupå’ŒMeasurementéƒ½é…ç½®äº†2æ¬¡æ‰§è¡Œçš„è¯ï¼Œé‚£ä¹ˆ@Setupå’Œ@TearDowné…ç½®çš„æ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°å°±4æ¬¡ã€‚</li>
<li>Level.Invocation æ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„å‰åæ‰§è¡Œï¼ˆä¸€èˆ¬ä¸æ¨èè¿™ä¹ˆç”¨ï¼‰</li>
</ul>
<p>é€šå¸¸çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬ä¼šæ¯”è¾ƒè¿·æƒ‘Iterationå’ŒInvocationåŒºåˆ«ï¼Œæˆ‘ä»¬åœ¨é…ç½®Warmupçš„æ—¶å€™é»˜è®¤çš„æ—¶é—´æ˜¯çš„1sï¼Œå³1sçš„æ‰§è¡Œä½œä¸ºä¸€ä¸ªIterationï¼Œå‡è®¾æ¯æ¬¡æ–¹æ³•çš„æ‰§è¡Œæ˜¯100msçš„è¯ï¼Œé‚£ä¹ˆ1ä¸ªIterationå°±ä»£è¡¨10ä¸ªInvocationã€‚</p>
<h3 id="Param"><a href="#Param" class="headerlink" title="@Param"></a><strong>@Param</strong></h3><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•ä¸åŒçš„å‚æ•°çš„ä¸åŒç»“æœï¼Œä½†æ˜¯æµ‹è¯•çš„äº†é€»è¾‘åˆéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬ç¼–å†™é•€é“¬benchmarkçš„è¯ä¼šé€ æˆé€»è¾‘çš„å†—ä½™ï¼Œå¹¸å¥½JMHæä¾›äº†@Paramå‚æ•°æ¥å¸®åŠ©æˆ‘ä»¬å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œè¢«@Paramæ³¨è§£æ ‡ç¤ºçš„å‚æ•°ç»„ä¼šä¸€æ¬¡è¢«benchmarkæ¶ˆè´¹åˆ°ã€‚</p>
<pre><code class="java">@State(Scope.Benchmark)
public class ParamTest &#123;

    @Param(&#123;&quot;1&quot;, &quot;2&quot;, &quot;3&quot;&#125;)
    int testNum;

    @Benchmark
    public String test() &#123;
        return String.valueOf(testNum);
    &#125;

    public static void main(String[] args) throws RunnerException &#123;
        Options opt = new OptionsBuilder()
                .include(ParamTest.class.getSimpleName())
                .forks(1)
                .build();

        new Runner(opt).run();
    &#125;
&#125;
</code></pre>
<h3 id="Fork"><a href="#Fork" class="headerlink" title="@Fork"></a><strong>@Fork</strong></h3><p><code>fork</code>å‡ºå¤šå°‘ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡ŒåŒä¸€åŸºå‡†æµ‹è¯•æ–¹æ³•</p>
<h3 id="Threads"><a href="#Threads" class="headerlink" title="@Threads"></a><strong>@Threads</strong></h3><p>æµ‹è¯•çº¿ç¨‹çš„æ•°é‡ï¼Œå¯ä»¥é…ç½®åœ¨æ–¹æ³•æˆ–è€…ç±»ä¸Šï¼Œä»£è¡¨æ‰§è¡Œæµ‹è¯•çš„çº¿ç¨‹æ•°é‡ã€‚è¯¥æµ‹è¯•ä½¿ç”¨çš„çº¿ç¨‹æ•°ã€‚é»˜è®¤æ˜¯Runtime.getRuntime().availableProcessors()</p>
<h2 id="å››ã€JMH-è¿›é˜¶"><a href="#å››ã€JMH-è¿›é˜¶" class="headerlink" title="å››ã€JMH è¿›é˜¶"></a>å››ã€JMH è¿›é˜¶</h2><p>å…¶å® JVM åšçš„ä¼˜åŒ–æ“ä½œè¿œä¸æ­¢ä¸Šé¢è¿™äº›ï¼Œè¿˜æœ‰æ¯”å¦‚å¸¸é‡ä¼ æ’­ï¼ˆConstant Propagationï¼‰ã€å¾ªç¯å±•å¼€ï¼ˆLoop Unwindingï¼‰ã€å¾ªç¯è¡¨è¾¾å¼å¤–æï¼ˆLoop Expression Hoistingï¼‰ã€æ¶ˆé™¤å…¬å…±å­è¡¨è¾¾å¼ï¼ˆCommon Subexpression Eliminationï¼‰ã€æœ¬å—é‡æ’åºï¼ˆBasic Block Reorderingï¼‰ã€èŒƒå›´æ£€æŸ¥æ¶ˆé™¤ï¼ˆRange Check Eliminationï¼‰ç­‰ã€‚</p>
<h3 id="æ— ç”¨ä»£ç æ¶ˆé™¤-ï¼ˆ-Dead-Code-Elimination-ï¼‰"><a href="#æ— ç”¨ä»£ç æ¶ˆé™¤-ï¼ˆ-Dead-Code-Elimination-ï¼‰" class="headerlink" title="æ— ç”¨ä»£ç æ¶ˆé™¤ ï¼ˆ Dead Code Elimination ï¼‰"></a>æ— ç”¨ä»£ç æ¶ˆé™¤ ï¼ˆ Dead Code Elimination ï¼‰</h3><p>ä¹Ÿæœ‰ç½‘å‹å½¢è±¡çš„ç¿»è¯‘æˆ<strong>æ­»ä»£ç </strong>ï¼Œæ­»ä»£ç æ˜¯æŒ‡é‚£äº› JVM ç»è¿‡æ£€æŸ¥å‘ç°çš„æ ¹æœ¬ä¸ä¼šä½¿ç”¨åˆ°çš„ä»£ç ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä»£ç ç‰‡æ®µã€‚</p>
<pre><code class="java">@State(Scope.Thread)
@BenchmarkMode(Mode.AverageTime)
@OutputTimeUnit(TimeUnit.NANOSECONDS)
public class JMHSample_08_DeadCode &#123;

    /*
     * è®¸å¤šåŸºå‡†æµ‹è¯•çš„å®å°æ˜¯æ¶ˆé™¤ä»£ç ï¼ˆDCEï¼‰ï¼šç¼–è¯‘å™¨è¶³å¤Ÿèªæ˜ï¼Œå¯ä»¥æ¨æ–­å‡ºæŸäº›è®¡ç®—æ˜¯å¤šä½™çš„ï¼Œå¹¶ä¸”å®Œå…¨æ¶ˆé™¤äº†å®ƒä»¬ã€‚
å¹¸è¿çš„æ˜¯ï¼ŒJMHæä¾›äº†é€‚å½“çš„åŸºç¡€æ¶æ„æ¥å¯¹æŠ—è¿™ä¸€ç‚¹ï¼šè¿”å›è®¡ç®—ç»“æœå°†è¦æ±‚JMHå¤„ç†ç»“æœä»¥é™åˆ¶æ¶ˆé™¤æ­»äº¡ä»£ç çš„æ¶ˆé™¤ (returned results
     are implicitly consumed by Blackholes, see JMHSample_09_Blackholes).
     */

    private double x = Math.PI;

    @Benchmark
    public void baseline() &#123;
        // do nothing, this is a baseline
    &#125;

    @Benchmark
    public void measureWrong() &#123;
        // é”™è¯¯çš„ï¼Œ ç»“æœæ²¡æœ‰ç”¨åˆ°ï¼Œè¢«ä¼˜åŒ–æ‰.
        Math.log(x);
    &#125;

    @Benchmark
    public double measureRight() &#123;
        // æ­£ç¡®çš„ï¼Œ ç»“æœæ²¡è¢«ç”¨åˆ°
        return Math.log(x);
    &#125;


    public static void main(String[] args) throws RunnerException &#123;
        Options opt = new OptionsBuilder()
                .include(JMHSample_08_DeadCode.class.getSimpleName())
                .forks(1)
                .build();

        new Runner(opt).run();
    &#125;

&#125;
</code></pre>
<p>æœ‰çš„ä»£ç æ²¡å•¥ç”¨ï¼Œå°±åœ¨ç¼–è¯‘å™¨è¢«æ¶ˆé™¤äº†ï¼Œä½†è¿™ç»™æˆ‘åšåŸºå‡†æµ‹è¯•å¸¦äº†ä¸€äº›éº»çƒ¦ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>baseline </code>å’Œ <code>measureWrong </code>æœ‰ç€ç›¸åŒçš„æ€§èƒ½ï¼Œå› ä¸ºç¼–è¯‘å™¨è§‰å¾— <code>measureWrong</code>è¿™æ®µä»£ç æ‰§è¡Œåæ²¡æœ‰ä»»ä½•å½±å“ï¼Œä¸ºäº†æ•ˆç‡ï¼Œå°±ç›´æ¥æ¶ˆé™¤æ‰è¿™æ®µä»£ç ï¼Œä½†æ˜¯å¦‚æœåŠ ä¸Šreturnè¯­å¥ï¼Œå°±ä¸ä¼šåœ¨ç¼–è¯‘æœŸè¢«å»æ‰ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨å†™åŸºå‡†æµ‹è¯•æ—¶éœ€è¦æ³¨æ„çš„ç‚¹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ <code>Blackholes</code> æ–¹æ³•æ¶ˆé™¤</p>
<h3 id="Blackhole-é»‘æ´"><a href="#Blackhole-é»‘æ´" class="headerlink" title="** Blackhole (é»‘æ´)**"></a>** Blackhole (é»‘æ´)**</h3><p>Blackholeä¼šæ¶ˆè´¹ä¼ è¿›æ¥çš„å€¼ï¼Œä¸æä¾›ä»»ä½•ä¿¡æ¯æ¥ç¡®å®šè¿™äº›å€¼æ˜¯å¦åœ¨ä¹‹åè¢«å®é™…ä½¿ç”¨ã€‚ Blackholeå¤„ç†çš„äº‹æƒ…ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>æ­»ä»£ç æ¶ˆé™¤ï¼šå…¥å‚åº”è¯¥åœ¨æ¯æ¬¡éƒ½è¢«ç”¨åˆ°ï¼Œå› æ­¤ç¼–è¯‘å™¨å°±ä¸ä¼šæŠŠè¿™äº›å‚æ•°ä¼˜åŒ–ä¸ºå¸¸é‡æˆ–è€…åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­å¯¹ä»–ä»¬è¿›è¡Œå…¶ä»–ä¼˜åŒ–ã€‚</li>
<li>å¤„ç†å†…å­˜å£ï¼šæˆ‘ä»¬éœ€è¦å°½å¯èƒ½å‡å°‘å†™çš„é‡ï¼Œå› ä¸ºå®ƒä¼šå¹²æ‰°ç¼“å­˜ï¼Œæ±¡æŸ“å†™ç¼“å†²åŒºç­‰ã€‚ è¿™å¾ˆå¯èƒ½å¯¼è‡´è¿‡æ—©åœ°æ’åˆ°å†…å­˜å£</li>
</ul>
<p>æˆ‘ä»¬åœ¨ä¸Šé¢è¯´åˆ°éœ€è¦æ¶ˆé™¤æ— ç”¨ä»£ç ï¼Œé‚£ä¹ˆå…¶ä¸­ä¸€ç§æ–¹å¼å°±æ˜¯é€šè¿‡Blackholeï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Blackholeæ¥æ¶ˆè´¹è¿™äº›è¿”å›çš„ç»“æœã€‚</p>
<pre><code class="java">1:è¿”å›æµ‹è¯•ç»“æœï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–
@Benchmark
public double measureRight_1() &#123;
    return Math.log(x1) + Math.log(x2);
&#125;

2.é€šè¿‡Blackholeæ¶ˆè´¹ä¸­é—´ç»“æœï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–
@Benchmark
public void measureRight_2(Blackhole bh) &#123;
    bh.consume(Math.log(x1));
    bh.consume(Math.log(x2));
&#125;
</code></pre>
<h3 id="DCEçš„å¸¸é‡æŠ˜å ï¼ˆconstant-foldingï¼‰"><a href="#DCEçš„å¸¸é‡æŠ˜å ï¼ˆconstant-foldingï¼‰" class="headerlink" title="DCEçš„å¸¸é‡æŠ˜å ï¼ˆconstant-foldingï¼‰"></a>DCEçš„å¸¸é‡æŠ˜å ï¼ˆconstant-foldingï¼‰</h3><p>åœ¨å¯¹ Java æºæ–‡ä»¶ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨é€šè¿‡è¯­æ³•åˆ†æï¼Œå¯ä»¥å‘ç°æŸäº›èƒ½ç›´æ¥å¾—åˆ°è®¡ç®—ç»“æœè€Œä¸ä¼šå†æ¬¡æ›´æ”¹çš„ä»£ç ï¼Œç„¶åä¼šå°†è®¡ç®—ç»“æœè®°å½•ä¸‹æ¥ï¼Œè¿™æ ·åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å°±ä¸éœ€è¦å†æ¬¡è¿ç®—äº†ã€‚æ¯”å¦‚è¿™æ®µä»£ç ã€‚</p>
<pre><code class="java">     private double x = Math.PI;
    private final double wrongX = Math.PI;

    @Benchmark
    public double measureWrong_1() &#123;
        // é”™è¯¯: æºæ˜¯å¯ä»¥é¢„æµ‹çš„ï¼Œå¹¶ä¸”è®¡ç®—æ˜¯å¯æŠ˜å çš„ã€‚
        return Math.log(Math.PI);
    &#125;

    @Benchmark
    public double measureWrong_2() &#123;
        // é”™è¯¯: the source is predictable, and computation is foldable.
        return Math.log(wrongX);
    &#125;

    @Benchmark
    public double measureRight() &#123;
        // æ­£ç¡®: the source is not predictable.
        return Math.log(x);
    &#125;
</code></pre>
<p>æœ¬ä¾‹ä»‹ç»äº† <code>constant-folding</code>ï¼Œå³å¸¸é‡æŠ˜å ï¼Œä¸Šè¿°ä»£ç çš„ <code>measureWrong_1 </code>å’Œ <code>measureWrong_2</code> ä¸­çš„è¿ç®—éƒ½æ˜¯å¯ä»¥é¢„æµ‹çš„å€¼ï¼Œæ‰€ä»¥ä¹Ÿä¼šåœ¨ç¼–è¯‘æœŸç›´æ¥æ›¿æ¢ä¸ºè®¡ç®—ç»“æœï¼Œä»è€Œå¯¼è‡´åŸºå‡†æµ‹è¯•å¤±è´¥ï¼Œæ³¨æ„ final ä¿®é¥°çš„å˜é‡ä¹Ÿä¼šè¢«æŠ˜å ã€‚</p>
<h3 id="å¾ªç¯å±•å¼€ï¼ˆLoop-Unwindingï¼‰"><a href="#å¾ªç¯å±•å¼€ï¼ˆLoop-Unwindingï¼‰" class="headerlink" title="** å¾ªç¯å±•å¼€ï¼ˆLoop Unwindingï¼‰**"></a>** å¾ªç¯å±•å¼€ï¼ˆLoop Unwindingï¼‰**</h3><p>ä¸è¦åœ¨åŸºå‡†æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨å¾ªç¯ï¼Œä½¿ç”¨å¾ªç¯å°±ä¼šå¯¼è‡´æµ‹è¯•ç»“æœä¸å‡†ç¡®ï¼ŒåŸå› å¾ˆå¤æ‚ï¼Œç”šè‡³å¯ä»¥å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»ã€‚ç®€å•èƒ½ç†è§£çš„ä¸€ç‚¹æ˜¯å¦‚æœä½¿ç”¨å¾ªç¯ï¼Œé¢„çƒ­å¯èƒ½å°±ä¼šå­˜åœ¨é—®é¢˜ã€‚</p>
<pre><code class="java">
/**
 * åŸºå‡†æµ‹è¯•æ–¹æ³•ä¸­è¿›è¡Œå¾ªç¯æ˜¯ååšæ³•
 **/
@State(Scope.Thread)
@BenchmarkMode(Mode.AverageTime)
@OutputTimeUnit(TimeUnit.NANOSECONDS)
public class JMHSample_11_Loops &#123;

    /*
     * It would be tempting for users to do loops within the benchmarked method.
     * (This is the bad thing Caliper taught everyone). These tests explain why
     * this is a bad idea.
     *
     Looping is done in the hope of minimizing the overhead of calling the
      test method, by doing the operations inside the loop instead of inside
     the method call. Don&#39;t buy this argument; you will see there is more
      magic happening when we allow optimizers to merge the loop iterations.
     *
     * åœ¨åŸºå‡†æµ‹è¯•æ–¹æ³•ä¸­åšå¾ªç¯æ˜¯å¾ˆè¯±äººçš„ã€‚è¿™æ˜¯Caliperæ•™ç»™å¤§å®¶çš„åäº‹æƒ…ã€‚ä»¥ä¸‹æµ‹è¯•å‘Šè¯‰ä½ åŸå› ã€‚
     *
     * å¾ªç¯æ˜¯ä¸ºäº†é€šè¿‡åœ¨å¾ªç¯å†…è€Œä¸æ˜¯åœ¨æ–¹æ³•è°ƒç”¨å†…éƒ¨è¿›è¡Œæ“ä½œæ¥æœ€å°åŒ–è°ƒç”¨æµ‹è¯•æ–¹æ³•çš„å¼€é”€ã€‚ï¼Ÿï¼Ÿï¼Ÿ
     * ä¸è¦ä¹°è¿™ä¸ªè®ºç‚¹;å½“æˆ‘ä»¬å…è®¸ä¼˜åŒ–å™¨åˆå¹¶å¾ªç¯è¿­ä»£æ—¶ï¼Œä½ ä¼šå‘ç°æœ‰æ›´å¤šçš„é­”æ³•å‘ç”Ÿã€‚
     */


    int x = 1;
    int y = 2;

    /*
     * This is what you do with JMH.
     */

    @Benchmark
    public int measureRight() &#123;
        return (x + y);
    &#125;


    private int reps(int reps) &#123;
        int s = 0;
        for (int i = 0; i &lt; reps; i++) &#123;
            s += (x + y);
        &#125;
        return s;
    &#125;

    @Benchmark
    @OperationsPerInvocation(1)
    public int measureWrong_1() &#123;
        return reps(1);
    &#125;

    @Benchmark
    @OperationsPerInvocation(10)
    public int measureWrong_10() &#123;
        return reps(10);
    &#125;

    @Benchmark
    @OperationsPerInvocation(100)
    public int measureWrong_100() &#123;
        return reps(100);
    &#125;

    @Benchmark
    @OperationsPerInvocation(1000)
    public int measureWrong_1000() &#123;
        return reps(1000);
    &#125;

    @Benchmark
    @OperationsPerInvocation(10000)
    public int measureWrong_10000() &#123;
        return reps(10000);
    &#125;

    @Benchmark
    @OperationsPerInvocation(100000)
    public int measureWrong_100000() &#123;
        return reps(100000);
    &#125;

    public static void main(String[] args) throws RunnerException &#123;
        Options opt = new OptionsBuilder()
                .include(JMHSample_11_Loops.class.getSimpleName())
                .forks(1)
                .build();
        new Runner(opt).run();
    &#125;

&#125;
</code></pre>
<pre><code class="shell">Benchmark                               Mode  Cnt  Score    Error  Units
JMHSample_11_Loops.measureRight         avgt    5  1.657 Â±  0.008  ns/op
JMHSample_11_Loops.measureWrong_1       avgt    5  1.772 Â±  0.941  ns/op
JMHSample_11_Loops.measureWrong_10      avgt    5  0.195 Â±  0.151  ns/op
JMHSample_11_Loops.measureWrong_100     avgt    5  0.020 Â±  0.009  ns/op
JMHSample_11_Loops.measureWrong_1000    avgt    5  0.018 Â±  0.001  ns/op
JMHSample_11_Loops.measureWrong_10000   avgt    5  0.017 Â±  0.014  ns/op
JMHSample_11_Loops.measureWrong_100000  avgt    5  0.015 Â±  0.001  ns/op
</code></pre>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œå¾ªç¯æ¬¡æ•°é˜…è¯»ï¼Œç»Ÿè®¡å‡ºæ¥çš„æ—¶é—´è¶ŠçŸ­ã€‚åˆ°ç›®å‰ä½ç½®ï¼Œæ¯æ¬¡æ“ä½œçš„æ—¶é—´å·²ç»æ˜¯1/20 nsï¼Œè¿œè¿œè¶…è¿‡ç¡¬ä»¶çš„å®é™…èƒ½åŠ›ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºå¾ªç¯è¢«å¤§é‡<code>unrolled</code>/<code>pipelined</code>ï¼Œå¹¶ä¸”è¦ä»å¾ªç¯ä¸­æå‡è¦æµ‹é‡çš„æ“ä½œã€‚è§„åˆ™ï¼šä¸è¦è¿‡åº¦ä½¿ç”¨å¾ªç¯ï¼Œä¾é JMHæ¥æ­£ç¡®æµ‹é‡ã€‚</p>
<p>æˆ‘ä»¬è™½ç„¶å¯ä»¥åœ¨<code>Benchmark</code>ä¸­å®šä¹‰å¾ªç¯é€»è¾‘ï¼Œä½†æ˜¯è¿™ä¹ˆåšå…¶å®æ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸ºç¼–è¯‘å™¨å¯èƒ½ä¼šå°†æˆ‘ä»¬çš„å¾ªç¯è¿›è¡Œå±•å¼€æˆ–è€…åšä¸€äº›å…¶ä»–æ–¹é¢çš„å¾ªç¯ä¼˜åŒ–ï¼Œæ‰€ä»¥JHMå»ºè®®æˆ‘ä»¬ä¸è¦åœ¨<code>Beanchmark</code>ä¸­ä½¿ç”¨å¾ªç¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¤„ç†å¾ªç¯é€»è¾‘äº†ï¼Œå¯ä»¥ç»“åˆ**@BenchmarkMode(Mode.SingleShotTime)<strong>å’Œ</strong>@Measurement(batchSize = N)**æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœ.</p>
<pre><code class="java">@State(Scope.Thread)
public class JMHSample_26_BatchSize &#123;

    List&lt;String&gt; list = new LinkedList&lt;&gt;();

    // æ¯ä¸ªiterationä¸­åš5000æ¬¡Invocation
    @Benchmark
    @Warmup(iterations = 5, batchSize = 5000)
    @Measurement(iterations = 5, batchSize = 5000)
    @BenchmarkMode(Mode.SingleShotTime)
    public List&lt;String&gt; measureRight() &#123;
        list.add(list.size() / 2, &quot;something&quot;);
        return list;
    &#125;

    @Setup(Level.Iteration)
    public void setup()&#123;
        list.clear();
    &#125;

    public static void main(String[] args) throws RunnerException &#123;
        Options opt = new OptionsBuilder()
                .include(JMHSample_26_BatchSize.class.getSimpleName())
                .forks(1)
                .build();

        new Runner(opt).run();
    &#125;

&#125;
</code></pre>
<h3 id="æ–¹æ³•å†…è”"><a href="#æ–¹æ³•å†…è”" class="headerlink" title="æ–¹æ³•å†…è”"></a><strong>æ–¹æ³•å†…è”</strong></h3><p>æ–¹æ³•å†…è”ï¼šå¦‚æœJVMç›‘æµ‹åˆ°ä¸€äº›å°æ–¹æ³•è¢«é¢‘ç¹çš„æ‰§è¡Œï¼Œå®ƒä¼šæŠŠæ–¹æ³•çš„è°ƒç”¨æ›¿æ¢æˆæ–¹æ³•ä½“æœ¬èº«ã€‚æ¯”å¦‚è¯´ä¸‹é¢è¿™ä¸ªï¼š</p>
<pre><code class="java">    private int add4(int x1, int x2, int x3, int x4) &#123;
        return add2(x1, x2) + add2(x3, x4);
    &#125;

    private int add2(int x1, int x2) &#123;
        return x1 + x2;
    &#125;
</code></pre>
<p>è¿è¡Œä¸€æ®µæ—¶é—´åJVMä¼šæŠŠadd2æ–¹æ³•å»æ‰ï¼Œå¹¶æŠŠä½ çš„ä»£ç ç¿»è¯‘æˆï¼š</p>
<pre><code class="java">    private int add4(int x1, int x2, int x3, int x4) &#123;
        return x1 + x2 + x3 + x4;
    &#125;
</code></pre>
<p>JMHæä¾›äº†CompilerControlæ³¨è§£æ¥æ§åˆ¶æ–¹æ³•å†…è”ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘æ„Ÿè§‰æ¯”è¾ƒæœ‰ç”¨çš„å°±æ˜¯ä¸¤ä¸ªäº†ï¼š</p>
<ul>
<li>CompilerControl.Mode.DONT_INLINEï¼šå¼ºåˆ¶é™åˆ¶ä¸èƒ½ä½¿ç”¨å†…è”</li>
<li>CompilerControl.Mode.INLINEï¼šå¼ºåˆ¶ä½¿ç”¨å†…è” çœ‹ä¸€ä¸‹å®˜æ–¹æä¾›çš„ä¾‹å­</li>
<li>CompilerControl.Mode.EXCLUDEï¼šä¸ç¼–è¯‘</li>
</ul>
<pre><code class="java">@State(Scope.Thread)
@BenchmarkMode(Mode.AverageTime)
@OutputTimeUnit(TimeUnit.NANOSECONDS)
public class JMHSample_16_CompilerControl &#123;

    public void target_blank() &#123;

    &#125;

    @CompilerControl(CompilerControl.Mode.DONT_INLINE)
    public void target_dontInline() &#123;

    &#125;

    @CompilerControl(CompilerControl.Mode.INLINE)
    public void target_inline() &#123;

    &#125;
    
    @CompilerControl(CompilerControl.Mode.EXCLUDE)
    public void target_exclude() &#123;

    &#125;

    @Benchmark
    public void baseline() &#123;

    &#125;

    @Benchmark
    public void dontinline() &#123;
        target_dontInline();
    &#125;

    @Benchmark
    public void inline() &#123;
        target_inline();
    &#125;

    public static void main(String[] args) throws RunnerException &#123;
        Options opt = new OptionsBuilder()
                .include(JMHSample_16_CompilerControl.class.getSimpleName())
                .warmupIterations(0)
                .measurementIterations(3)
                .forks(1)
                .build();

        new Runner(opt).run();
    &#125;
&#125;

======================================æ‰§è¡Œç»“æœ==============================
Benchmark                                Mode  Cnt  Score   Error  Units
JMHSample_16_CompilerControl.baseline    avgt    3  0.896 Â± 3.426  ns/op
JMHSample_16_CompilerControl.dontinline  avgt    3  0.344 Â± 0.126  ns/op
JMHSample_16_CompilerControl.inline      avgt    3  0.391 Â± 2.622  ns/op
JMHSample_16_CompilerControl.exclude     avgt    3 52.937 Â± 5.622  ns/op
======================================æ‰§è¡Œç»“æœ==============================
</code></pre>
<p>æœ¬ä¾‹æåˆ°äº†JVMçš„æ–¹æ³•å†…è”ï¼Œç®€å•æ¥è¯´æ¯”è¾ƒçŸ­ä½†æ˜¯æ‰§è¡Œé¢‘ç‡åˆå¾ˆé«˜çš„æ–¹æ³•ï¼Œåœ¨æ‰§è¡Œå¤šæ¬¡åï¼ŒJVMå°†è¯¥æ–¹æ³•çš„è°ƒç”¨æ›¿æ¢ä¸ºæœ¬èº«ï¼Œä»¥å‡å°‘å‡ºæ ˆå…¥æ ˆï¼Œä»è€Œå‡å°‘æ€§èƒ½çš„æ¶ˆè€—ã€‚ä½†æ˜¯Javaæ–¹æ³•å†…è”æ˜¯æ— æ³•äººä¸ºæ§åˆ¶çš„ã€‚</p>
<p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°å†…è”æ–¹æ³•å’Œç©ºæ–¹æ³•æ‰§è¡Œé€Ÿåº¦ä¸€æ ·ï¼Œä¸ç¼–è¯‘æ‰§è¡Œæœ€æ…¢ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/885895#slide-7">JMH - Java ä»£ç æ€§èƒ½æµ‹è¯•çš„ç»ˆæåˆ©å™¨ã€å¿…é¡»æŒæ¡</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq1620657419/article/details/111669194">JavaåŸºå‡†æµ‹è¯•å·¥å…· â€”â€” JMHä½¿ç”¨æŒ‡å—</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/899469">åŸºå‡†æµ‹è¯•ç¥å™¨JMH â€”â€” è¯¦è§£36ä¸ªå®˜æ–¹ä¾‹å­</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/66170204">https://zhuanlan.zhihu.com/p/66170204</a></li>
</ul>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ monk6658@163.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">ğŸ’°</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    å­¦å¦‚é€†æ°´è¡ŒèˆŸï¼Œä¸è¿›åˆ™é€€
</p>
<!--<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>-->

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">Ã—</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="æ‰«ç æ”¯æŒ">
            <img src="/img/weixin.jpg" class="weixin" title="æ‰«ç æ”¯æŒ">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
